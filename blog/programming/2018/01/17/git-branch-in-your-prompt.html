<!DOCTYPE html>

<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    <title>Git branch in your prompt</title>
    <meta name="description" content="">
  

  <link
    rel="canonical"
    href="https://alicja.dev/blog/programming/2018/01/17/git-branch-in-your-prompt.html"
  >

  <link rel="icon" href="https://alicja.dev/favicon.ico">

  <link type="application/atom+xml" rel="alternate" href="https://alicja.dev/feed.xml" title="Alicja's thoughts" />

  <style>
    
    html,body,div,span,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,code,em,img,small,strong,sub,sup,var,b,u,i,ol,ul,article,canvas,embed,figure,figcaption,footer,header,hgroup,nav,ruby,section,summary,time,mark,audio,video{border:0;font-size:100%;font:inherit;vertical-align:baseline;box-sizing:border-box}body{background-color:snow;font-size:18px;font-family:Helvetica, sans-serif}p{margin-bottom:10px}h1{font-size:3em;color:#E9113E;font-weight:700;margin-bottom:20px}h2{margin-bottom:15px;font-size:1.5em}h3{margin-bottom:12px;font-size:1.2em}h4{margin-bottom:10px;font-weight:700}a{text-decoration:none;color:#E9113E}header{position:relative;font-family:"Trebuchet MS", Helvetica, sans-serif;margin-bottom:30px}header li{list-style-type:none;display:inline;margin:0;padding:0}header li a{color:inherit}header ul,nav{display:inline-block;margin:0;padding:0}.container{background-color:white;width:70%;max-width:900px;min-width:400px;margin:0 auto;padding:20px 40px 0 40px;overflow:hidden}.squiggle{letter-spacing:-14px;font-size:50px;color:#E9113E;margin-left:-60px;margin-right:-60px}.post{margin:2em 0 2em 0}code,pre{font-family:Monaco, Lucida Console, Courier New, monospace;color:#333;font-size:14px}pre{padding:8px 15px;background:#f8f8f8;border-radius:5px;border:1px solid #e5e5e5;overflow-x:auto;white-space:pre-wrap}blockquote{border-left:1px solid #e5e5e5;margin:0;padding:0 0 0 20px;font-style:italic}em{font-style:italic}.idea>h3{font-weight:700}.highlight .hll{background-color:#ffc}.highlight .c{color:#999988;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{color:#000000;font-weight:bold}.highlight .o{color:#000000;font-weight:bold}.highlight .cm{color:#999988;font-style:italic}.highlight .cp{color:#999999;font-weight:bold;font-style:italic}.highlight .c1{color:#999988;font-style:italic}.highlight .cs{color:#999999;font-weight:bold;font-style:italic}.highlight .gd{color:#000000;background-color:#fdd}.highlight .ge{color:#000000;font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000000;background-color:#dfd}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{color:#000000;font-weight:bold}.highlight .kd{color:#000000;font-weight:bold}.highlight .kn{color:#000000;font-weight:bold}.highlight .kp{color:#000000;font-weight:bold}.highlight .kr{color:#000000;font-weight:bold}.highlight .kt{color:#445588;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d01040}.highlight .na{color:teal}.highlight .nb{color:#0086B3}.highlight .nc{color:#445588;font-weight:bold}.highlight .no{color:teal}.highlight .nd{color:#3c5d5d;font-weight:bold}.highlight .ni{color:purple}.highlight .ne{color:#990000;font-weight:bold}.highlight .nf{color:#990000;font-weight:bold}.highlight .nl{color:#990000;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{color:#000000;font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d01040}.highlight .sc{color:#d01040}.highlight .sd{color:#d01040}.highlight .s2{color:#d01040}.highlight .se{color:#d01040}.highlight .sh{color:#d01040}.highlight .si{color:#d01040}.highlight .sx{color:#d01040}.highlight .sr{color:#009926}.highlight .s1{color:#d01040}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}

  </style>
</head>

  <body>
    <div class="container">
      <header role="banner">
  <hgroup id="header-title">
    <h1><a href="/">Alicja Laszuk</a></h1>
  </hgroup>
  <nav role="navigation" id="main-navigation">
    <ul>
    
        <li><a href="/blog">blog &middot;</a></li>
        <li><a href="/ideas">ideas &middot;</a></li>
        <li><a href="/resume">resume &middot;</a></li>
        <li><a href="/pl">[polski] &middot;</a></li>
    
    </ul>
  </nav>
  <ul id="external-links">
    <li>
      <a href="https://github.com/trueskawka">github &middot;</a>
    </li>
    <li>
      <a href="https://twitter.com/mamrotynka">twitter</a>
    </li>
  </ul>
</header>

      <main>
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div>
    <p class="post-meta">
      <time datetime="2018-01-17T20:41:00-08:00" itemprop="datePublished">
        
          01/17/2018 20:41
        
      </time>
    </p>
    <p>
      <h2 class="post-title" itemprop="name headline">
        Git branch in your prompt
      </h2>
    </p>
  </div>

  <div class="post-content" itemprop="articleBody">
    <p>I have paired a lot over the past week (which makes me tremendously happy!)
and I noticed how lost I can get in someone else’s terminal if I don’t have
my regular bash prompt - not only the cute little heart that welcomes me
every time I run the terminal, but also the git branch name I’m currently on.</p>

<p>As I couldn’t find the tutorial I used to learn how to parse the git branch, 
I decided to go through my <code class="highlighter-rouge">.bashrc</code> and write one myself.</p>

<h3 id="bash-prompt-variables">Bash prompt variables</h3>
<p>Bash prompt variables hold the text that shows as the terminal prompt in 
various contexts. Their values are examined and executed just before Bash 
prints them. There are several of them, but for now I’m going to 
focus on <code class="highlighter-rouge">PS1</code>, which is the primary prompt string.</p>

<p>In a bash prompt, you can use:</p>
<ul>
  <li><a href="https://tiswww.case.edu/php/chet/bash/bashref.html#Controlling-the-Prompt">special characters</a> 
that can be used for current user name (<code class="highlighter-rouge">\u</code>), time (<code class="highlighter-rouge">\t</code>), host name (<code class="highlighter-rouge">\h</code>) etc.</li>
  <li><a href="https://en.wikipedia.org/wiki/ANSI_escape_code#Colors">colors</a> both for the 
foreground and the background</li>
  <li>unicode characters (letters, numbers, symbols, emoji)</li>
  <li>custom variables</li>
</ul>

<p>Let’s look at an example value of <code class="highlighter-rouge">PS1</code>: <code class="highlighter-rouge">\s-\v\$</code></p>
<ul>
  <li><code class="highlighter-rouge">\s</code> the name of the shell</li>
  <li><code class="highlighter-rouge">-</code> just a dash</li>
  <li><code class="highlighter-rouge">\v</code> the version of the shell</li>
  <li><code class="highlighter-rouge">$</code> a dollar sign at the end of the prompt</li>
</ul>

<p>which in my terminal evaluates to: <code class="highlighter-rouge">-bash-3.2$</code></p>

<p>To change the value of <code class="highlighter-rouge">PS1</code> for the current session, you can use 
<code class="highlighter-rouge">export PS1="&lt;value&gt;"</code> in the terminal:</p>
<ul>
  <li>adding a lambda
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PS1="λ "
</code></pre></div>    </div>
  </li>
  <li>changing the lambda’s color to red
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PS1="\[\033[0;31m\]λ \[\033[0m\]"
</code></pre></div>    </div>
  </li>
  <li>adding the current directory before the red lambda
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PS1="\w\[\033[0;31m\] λ \[\033[0m\]"
</code></pre></div>    </div>
  </li>
</ul>

<p>and so on.</p>

<p>If you want to make the <code class="highlighter-rouge">PS1</code> more permanent, you can add it to your <code class="highlighter-rouge">.bashrc</code> (or <code class="highlighter-rouge">.bash_profile</code>,
if <a href="https://apple.stackexchange.com/questions/51036/what-is-the-difference-between-bash-profile-and-bashrc">you’re on a Mac</a>),
reload your session with</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source .bashrc
</code></pre></div></div>
<p>et voilà!</p>

<h3 id="getting-information-from-git">Getting information from git</h3>
<p>When I work on code, I usually want to know a few things:</p>
<ul>
  <li>am I using git? (if not, I might want to <code class="highlighter-rouge">git init</code>)</li>
  <li>what branch I am currently on?</li>
  <li>are there any changes in the directory - untracked, unadded, added or deleted files?</li>
</ul>

<p>All of those things I can check by simply using the <code class="highlighter-rouge">git status</code> command, but it gets 
tedious to do that every time I need to change something (am I on the right branch? 
did I add everything? did I switch to a feature branch?). I can also parse git commands 
output with Bash and add the parsed information to my prompt, using custom variables.</p>

<p><strong>Branch</strong></p>

<p>In order to get the current branch, you can parse the output of
<a href="https://stackoverflow.com/questions/6245570/how-to-get-the-current-branch-name-in-git">several different git commands</a>. 
I don’t think there is one good way to do it, as you might want to get slightly different
results depending on the context, but some good ideas are:</p>
<ul>
  <li><code class="highlighter-rouge">git rev-parse --abbrev-ref HEAD</code> - which gives you the right name of the local branch and consistent 
<code class="highlighter-rouge">HEAD</code> for other contexts</li>
  <li><code class="highlighter-rouge">git branch | sed -n '/\* /s///p'</code> - which gives you the right name of the local branch and appropriate
outputs for other contexts</li>
</ul>

<p>Whichever method you choose, to add it to your <code class="highlighter-rouge">PS1</code> prompt you can:</p>
<ul>
  <li>add a function for parsing the branch (the <code class="highlighter-rouge">2&gt;/dev/null</code> stops the command from printing the output):
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git_prompt() {
  local ref=$(git branch 2&gt;/dev/null | sed -n '/\* /s///p')
  if [ "$ref" != "" ]
  then
    echo "($ref) "
  fi
}
</code></pre></div>    </div>
  </li>
  <li>add the function output to your prompt
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PS1="\w\[\033[0;31m\] λ $(git_prompt)\[\033[0m\]"
</code></pre></div>    </div>
    <p>or, with a hint of color</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PS1="\w\[\033[0;31m\] λ \[\033[0;95m\]\$(git_prompt)\[\033[0m\]\[\033[0m\]"
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Number of various changes</strong></p>

<p>You can run <code class="highlighter-rouge">git status</code> with various options - if you use the <a href="https://git-scm.com/docs/git-status#_short_format">short format</a>,
you will get the statuses of your paths that are a bit easier to understand for parsing purposes, notably:</p>
<ul>
  <li><code class="highlighter-rouge">?</code> for untracked paths</li>
  <li><code class="highlighter-rouge">M</code> for modified paths</li>
  <li><code class="highlighter-rouge">A</code> for added paths</li>
  <li><code class="highlighter-rouge">D</code> for deleted paths</li>
</ul>

<p>To parse untracked paths you can:</p>
<ul>
  <li>grep <code class="highlighter-rouge">git status --porcelain</code> for <code class="highlighter-rouge">?</code> and count the number of lines in the output (as each untracked path
is on a new line)
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>untracked=`expr $(git status --porcelain 2&gt;/dev/null | grep "?" | wc -l)`
</code></pre></div>    </div>
  </li>
  <li>wrap it in a function that returns the number of untracked paths with a symbol of your choice when it’s not 0
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function parse_untracked {
  local untracked=`expr $(git status --porcelain 2&gt;/dev/null | grep "?" | wc -l)`
  if [ "$untracked" != "0" ]
  then
    echo " ?$untracked"
  fi
}
</code></pre></div>    </div>
  </li>
  <li>add it to your <code class="highlighter-rouge">PS1</code> prompt
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git_prompt() {
  local ref=$(git branch 2&gt;/dev/null | sed -n '/\* /s///p')
  if [ "$ref" != "" ]
  then
    echo "($ref)$(parse_untracked) "
  fi
}
</code></pre></div>    </div>
  </li>
</ul>

<p>You can add a separate function for each status and add them to your prompt by simply grepping for the appropriate
symbol and wrapping it in a function. For reference, my full git parsing code is 
<a href="https://gist.github.com/trueskawka/aab826ea75d7219790df92fba8bb8e47">in this gist</a>.</p>

<p>Have fun adjusting your prompt and hopefully never getting lost among your git branches!</p>

  </div>
</article>

      </main>
    </div>
  </body>
  <footer>
  <div class="container">
    <div class="squiggle" aria-hidden="true">
      ∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿∿
    </div>
  </div>
</footer>

</html>
